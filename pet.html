<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>鸟宝寄养服务驿站</title>
    <link rel="stylesheet" href="./css/pet.css">
    <style>
       
    </style>

</head>

<body>
    <!-- 背景容器 -->
    <div class="background-container" id="backgroundContainer">
        <div class="background-image" id="backgroundImage"></div>
    </div>

    <div class="name" style="margin: 0;">


        <h2 style="color: #ff771e;font-weight: 600;">🦜Qfly鸟宝驿站</h2>


        <div class="card">

            <p style="color: #ffc812;display: block;text-align: center;font-size:12px">
                ⭐支持寄养下列品种（雏鸟、半毛除外），可完全隔离，不混养<BR>
                ⭐360°超大观景房宝贝住得舒心，提供每日换水换粮等服务<BR>
                ⭐支持全天直播，让你出差也可随时随地查看鸟宝和远程互动<BR>
                ⭐需寄养其他类型可私聊（自备专用粮，金太阳/金刚不予接收）<BR>
                ⭐寄养总价享95折优惠，总价越高折扣优惠越大（节假日原价）<BR>
                <span id="notice" style="color: #e9e9e9;">寄养前请阅读《寄养服务声明》，确认寄养视为已同意此条款</span><BR>
            </p>

            <p onclick="tb()" style="cursor:pointer">定制您的寄养计划</p>

            <section style="padding: 0 16px;">
                <p><strong>寄养品种（可多选）：</strong></p>

                <div class="bird-option">
                    <label>
                        <input type="checkbox" name="birdType" value="6.6" data-name="虎皮" checked>
                        虎皮 | 牡丹 (¥6.6/天) 数量
                    </label>
                    <input type="number" class="quantity-input" value="1" min="1" max="100">
                </div>

                <div class="bird-option">
                    <label>
                        <input type="checkbox" name="birdType" value="8.8" data-name="玄凤">
                        玄凤 | 太平洋 (¥8.8/天) 数量
                    </label>
                    <input type="number" class="quantity-input" value="1" min="1" max="100" disabled>
                </div>

                <div class="bird-option">
                    <label>
                        <input type="checkbox" name="birdType" value="9.9" data-name="和尚">
                        和尚 | 小太阳 (¥9.9/天) 数量
                    </label>
                    <input type="number" class="quantity-input" value="1" min="1" max="100" disabled>
                </div>

                <div class="bird-option">
                    <label>
                        <input type="checkbox" name="birdType" value="16" data-name="其他">
                        其他私聊 (¥12~20/天) 数量
                    </label>
                    <input type="number" class="quantity-input" value="1" min="1" max="100" disabled>
                </div>

                <p style="margin-top: 16px;"><strong>🕓寄养起止日期（最低5日）：</strong><br>
                    <input type="date" id="startDate" style="width: 102px;"> —
                    <input type="date" id="endDate" style="width: 102px;">
                </p>
                <p style="margin-top: 16px;"><strong>💗额外寄养服务：</strong><br>
                <div class="bird-option"><label>
                        <input type="checkbox" name="birdType" value="1.88" data-name="">
                        全天24小时直播（¥1.88/天）
                        <br>
                        热风恒温保暖（独立计费¥2/半天）
                    </label></div>
                </p>
                <p style="margin-top: 16px;color: #ffbb00;"><strong>总价：¥<span id="totalCost">0.00</span></strong></p>
            </section>

            <p>选择您适合的支付方式：</p>

            <div class="payment-method">


                <label class="method-option">
                    <input type="radio" name="payment" value="bank">

                    <img src="./img/z.png" width="22px">&nbsp;
                    支付宝（推荐）
                </label>

                <div class="qr-code-container" id="qrCode2">
                    <div class="qr-code">
                        <img src="./img/alipay.png" alt="支付宝支付二维码" width="222px">
                    </div>
                </div>

                <label class="method-option">
                    <input type="radio" name="payment" value="wechat">
                    <span class="method-icon">✅</span>&nbsp;
                    微信
                </label>

                <div class="qr-code-container" id="qrCode1">
                    <div class="qr-code">
                        <img src="./img/wx.png" alt="微信支付二维码" width="222px">
                    </div>
                </div>
            </div>

        </div>

    </div>

    <!-- 弹窗 -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">寄养服务声明</div>
                <button class="close-btn" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <p><b>甲方：寄养人</b></p>
                <p><b>乙方：收养人</b></p>
                <ul>
                    <li>宠物当前存在以下情况的，原则上不予寄养，包括但不限于：
                        <ul>
                            <li>宠物当前处于非健康状态（如感冒、发烧、肠胃病等）。</li>
                            <li>宠物既往存在的先天性疾病、遗传缺陷、基础疾病（如心脏、呼吸系统疾病、免疫缺陷等）；以及体弱多病、抵抗力低下导致的状况。</li>
                            <li>如有以上情况甲方应事先如实告知，乙方视情况决定是否收养，如未事先告知视为无上述情形。</li>
                        </ul>
                    </li>
                    <li>宠物因自身原因造成的伤害或死亡，乙方不承担相关责任
                        <ul>
                            <li>包括但不限于：宠物自残行为如啄羽、撞笼等非人为因素引起的伤亡。</li>
                        </ul>
                    </li>
                    <li>乙方仅提供日常照料服务（换饮用水和添加粮食，手养鸟陪玩），不承担其他医疗责任，乙方不对宠物患病导致的意外情况承担责任；
                        <ul>
                            <li>若宠物在寄养期间出现健康问题，乙方有义务及时通知甲方，因甲方未及时响应造成的问题，乙方不承担责任。若乙方已通知宠物异常情况，但甲方未在8小时内作出处理决定或安排送医或接回，由此产生的后果由甲方自行承担；
                            </li>
                            <li>宠物出现健康问题时，乙方可在甲方授权下协助将宠物送医（当次陪护费50-100视情况而定），期间产生的交通、医疗等相关费用由甲方承担。</li>
                            乙方有权在极端情况下（如宠物濒危且无法联系到甲方时）可采取临时抢救应急措施，但不承担最终意外责任。
                    </li>
                    <li>乙方的远程监控仅供甲方查看，不得用于商业用途或其他非法目的。</li>
                </ul>
                </li>
                <li>不可抗力免责
                    <ul>
                        <li>因自然灾害、公共卫生事件、政府管制等不可抗力因素导致的服务中断或宠物损失，双方互不追责。</li>
                    </ul>
                </li>
                </ul>


                <h3>协议生效与终止</h3>
                <ul>
                    <li>本协议自双方服务发生之日起生效，自服务结束之日终止。</li>
                    <li>甲方提前结束寄养的，需提前72小时通知乙方，可协商比例退还费用。</li>
                    <li>乙方有权在以下情形下终止服务：
                        <ul>
                            <li>宠物出现严重疾病；</li>
                            <li>甲方长期失联或拒绝配合处理；</li>
                            <li>其他危及他人或公共安全的情况。</li>
                        </ul>
                    </li>
                </ul>

                <h3>其他约定</h3>
                <ul>
                    <li>因本协议引起的争议，双方应友好协商解决。</li>
                    <li>甲方接受服务表明确认已阅读并理解本协议全部内容，并自愿接受其约束。</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // 工具函数：格式化日期为 YYYY-MM-DD
        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        // 初始化日期限制
        function initDateInputs() {
            const today = new Date();
            const maxDate = new Date();
            maxDate.setDate(today.getDate() + 89); // 最多90天（含当天），所以+89

            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');

            const todayStr = formatDate(today);
            const maxStr = formatDate(maxDate);

            startDateInput.value = todayStr; // 默认选今天

            endDateInput.min = todayStr;
            endDateInput.max = maxStr;

            // 当 startDate 改变时，动态更新 endDate 的 min 和 max
            startDateInput.addEventListener('change', () => {
                const selectedStart = new Date(startDateInput.value);
                const newMin = new Date(selectedStart);
                const newMax = new Date(selectedStart);
                newMax.setDate(newMin.getDate() + 89); // 最多再加89天 → 总共90天

                endDateInput.min = formatDate(newMin);
                endDateInput.max = formatDate(newMax);

                // 如果当前 endDate 超出新范围，自动修正
                const currentEnd = new Date(endDateInput.value);
                if (endDateInput.value && (currentEnd < newMin || currentEnd > newMax)) {
                    endDateInput.value = formatDate(newMin); // 重置为 startDate
                }

                calculateTotal();
            });

            endDateInput.addEventListener('change', calculateTotal);
        }

        // 计算总价（含折扣），额外服务（无数量输入）按天数单独相乘后计入
        function calculateTotal() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            if (!startDate || !endDate) {
                document.getElementById('totalCost').innerText = '0.0';
                return;
            }

            const start = new Date(startDate);
            const end = new Date(endDate);

            if (end < start) {
                document.getElementById('totalCost').innerText = '0.0';
                return;
            }

            const days = Math.floor((end - start) / (1000 * 60 * 60 * 24)) + 1;
            if (days > 90) {
                document.getElementById('totalCost').innerText = '0.0';
                return;
            }

            let rawTotal = 0;
            const checkboxes = document.querySelectorAll('input[name="birdType"]');

            checkboxes.forEach(checkbox => {
                if (!checkbox.checked) return;
                const pricePerDay = parseFloat(checkbox.value) || 0;
                const birdOption = checkbox.closest('.bird-option');
                const quantityInput = birdOption ? birdOption.querySelector('.quantity-input') : null;

                if (quantityInput) {
                    // 品种：按数量 * 天数
                    const qty = parseInt(quantityInput.value, 10) || 0;
                    if (qty > 0) {
                        rawTotal += pricePerDay * qty * days;
                    }
                } else {
                    // 额外服务：按天数单独计入（默认数量视为1）
                    rawTotal += pricePerDay * days;
                }
            });

            let finalTotal = rawTotal;
            if (rawTotal >= 50) {
                finalTotal = rawTotal * 0.88;
            } else if (rawTotal > 30) {
                finalTotal = rawTotal * 0.95;
            }

            document.getElementById('totalCost').innerText = finalTotal.toFixed(1) + ' 🧧已优惠¥' + (rawTotal - finalTotal).toFixed(1);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化日期
            initDateInputs();

            const checkboxes = document.querySelectorAll('input[name="birdType"]');
            const quantityInputs = document.querySelectorAll('.quantity-input');

            // 为每个 checkbox 按其父节点查找对应数量输入并绑定事件（避免 index 不匹配）
            checkboxes.forEach(checkbox => {
                const birdOption = checkbox.closest('.bird-option');
                const qty = birdOption ? birdOption.querySelector('.quantity-input') : null;

                // 初始化：如果存在数量输入则根据 checkbox 初始状态设置 disabled
                if (qty) qty.disabled = !checkbox.checked;

                checkbox.addEventListener('change', function () {
                    if (qty) qty.disabled = !this.checked;
                    calculateTotal();
                });
            });

            // 数量变化时重新计算
            quantityInputs.forEach(input => {
                input.addEventListener('change', () => {
                    // 限制最小值
                    if (parseInt(input.value, 10) < 1 || isNaN(parseInt(input.value, 10))) {
                        input.value = 1;
                    }
                    calculateTotal();
                });
            });

            // 支付方式切换（保留原逻辑）
            const radioButtons = document.querySelectorAll('input[name="payment"]');
            const qrCode1 = document.getElementById('qrCode1');
            const qrCode2 = document.getElementById('qrCode2');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', function () {
                    if (this.value === 'wechat') {
                        qrCode1.classList.add('active');
                        qrCode2.classList.remove('active');
                    } else {
                        qrCode1.classList.remove('active');
                        qrCode2.classList.add('active');
                    }
                });
            });

            // 实现背景图片懒加载
            loadBackgroundImage();

            // 添加弹窗功能
            const noticeElement = document.getElementById('notice');
            const modalOverlay = document.getElementById('modalOverlay');
            const closeModalBtn = document.getElementById('closeModal');

            // 显示弹窗
            if (noticeElement) {
                noticeElement.addEventListener('click', function () {
                    modalOverlay.style.display = 'block';
                });
            }

            // 关闭弹窗
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', function () {
                    modalOverlay.style.display = 'none';
                });
            }

            // 点击遮罩层关闭弹窗
            if (modalOverlay) {
                modalOverlay.addEventListener('click', function (e) {
                    if (e.target === modalOverlay) {
                        modalOverlay.style.display = 'none';
                    }
                });
            }

            // 首次计算一次总价
            calculateTotal();
        });

        // 其他函数（如 jump）保留
        function jump() {
            window.open("https://www.office.com");
        }

        // 实现背景图片懒加载
        function loadBackgroundImage() {
            const backgroundImage = document.getElementById('backgroundImage');

            // 创建一个临时图片对象来加载背景图片
            const img = new Image();
            img.src = './img/bird.png';

            // 图片加载完成后的回调
            img.onload = function () {
                // 设置背景图片
                backgroundImage.style.backgroundImage = `url(${img.src})`;

                // 添加loaded类，触发动画效果
                backgroundImage.classList.add('loaded');
            };

            // 图片加载失败的处理
            img.onerror = function () {
                console.error('背景图片加载失败');
            };
        }
    </script>
</body>

</html>