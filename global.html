<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>å…¨çƒèµ„äº§é…ç½®è¿½è¸ªï¼ˆå«æœˆåº¦æ€»è§ˆï¼‰</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 20px;
      background-color: #f9f9f9;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    h1, h2 {
      color: #2c3e50;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      background: white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    th, td {
      padding: 10px;
      text-align: center;
      border: 1px solid #ddd;
    }
    th {
      background-color: #6a0dad;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #fafafa;
    }
    .outflow {
      color: #e74c3c;
      font-weight: bold;
    }
    .inflow {
      color: #27ae60;
      font-weight: bold;
    }
    .summary-box {
      background: #e8f4fc;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }
    .highlight {
      background-color: #fff9db;
    }
    .positive { color: #27ae60; }
    .negative { color: #e74c3c; }
  </style>
</head>
<body>
  <div class="container">

    <h2>ğŸ“ˆ æœˆåº¦èµ„äº§æ€»è§ˆ</h2>
    <table id="monthly-summary">
      <thead>
        <tr>
          <th>æœˆä»½</th>
          <th>æ€»èµ„äº§ï¼ˆCNYï¼‰</th>
          <th>ç¯æ¯”å˜åŒ–</th>
        </tr>
      </thead>
      <tbody id="monthly-body"></tbody>
    </table>

     <h2>ğŸ¦ å½“å‰èµ„äº§é…ç½®</h2>
    <table id="balances-table">
      <thead>
        <tr>
          <th>å¹³å°</th>
          <th>HKD</th>
          <th>USD</th>
          <th>CNY</th>
          <th>ç¾è‚¡èµ„äº§</th>
          <th>æ€»å€¼ (CNY)</th>
        </tr>
      </thead>
      <tbody id="balances-body"></tbody>
    </table>

    <h2>ğŸ’± èµ„é‡‘æµåŠ¨è®°å½•</h2>
    <table id="transactions-table">
      <thead>
        <tr>
          <th>æ—¥æœŸ</th>
          <th>è¯´æ˜</th>
          <th>å˜åŠ¨æ˜ç»†</th>
        </tr>
      </thead>
      <tbody id="transactions-body"></tbody>
    </table>

   
  </div>

  <script>
  // ==============================
  // é…ç½®åŒº
  // ==============================
  const config = {
    exchangeRates: { HKD: 0.89, USD: 7, CNY: 1 },
    // åˆå§‹å¹³å°ä½™é¢ï¼ˆå¯¹åº” 2025-12-31 å¿«ç…§ï¼‰
    // æ³¨æ„ï¼šUS_Equity ç°åœ¨è¡¨ç¤º ç¾è‚¡èµ„äº§çš„ USD ä»·å€¼
    initialBalances: {
      "ç›ˆç«‹": { HKD: 1100, USD: 2545, CNY: 0, US_Equity: 0 }, 
      "ä¸­é“¶é¦™æ¸¯": { HKD: 100, USD: 0, CNY: 0, US_Equity: 0 },
      "æ±‡ä¸°": { HKD: 888, USD: 0, CNY: 0, US_Equity: 0 },
      "ä¼—å®‰": { HKD: 3788, USD: 0, CNY: 0, US_Equity: 0 },
      "å¤©æ˜Ÿ": { HKD: 0, USD: 0, CNY: 0, US_Equity: 0 }
    },
    // æ‰€æœ‰äº¤æ˜“
    transactions: [
    //   {
    //     date: "2026-01-05",
    //     description: "æ±‡ä¸° â†’ å¤©æ˜Ÿ è½¬è´¦",
    //     movements: [
    //       { platform: "æ±‡ä¸°", currency: "HKD", amount: -100 },
    //       { platform: "å¤©æ˜Ÿ", currency: "HKD", amount: +100 }
    //     ]
    //   },
      {
        date: "2026-01-15",
        description: "ç¾è‚¡åˆ†çº¢",
        movements: [
          { platform: "ç›ˆç«‹", currency: "USD", amount: +5 }
        ]
      }
    ]
  };

  // ==============================
  // å·¥å…·å‡½æ•°
  // ==============================
  function toCNY(amount, currency) {
    return amount * (config.exchangeRates[currency] || 1);
  }

  function formatNumber(num) {
    if (isNaN(num)) return "0.00";
    return num.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  }

  function getMonthKey(dateStr) {
    return dateStr.substring(0, 7); // "2026-01"
  }

  // ==============================
  // è®¡ç®— 2025-12 åˆå§‹æ€»èµ„äº§ï¼ˆæŒ‰æ­£ç¡®é€»è¾‘ï¼Œä½†æœ€ç»ˆå¼ºåˆ¶è®¾ä¸º 22800ï¼‰
  // ==============================
  let initialTotal = 0;
  Object.values(config.initialBalances).forEach(bal => {
    initialTotal += toCNY(bal.HKD, "HKD") + 
                    toCNY(bal.USD, "USD") + 
                    bal.CNY + 
                    toCNY(bal.US_Equity, "USD"); // âœ… ä¿®æ­£ï¼šUS_Equity æ˜¯ USD
  });

  // è®¾ä¸º 22,800 CNY
  initialTotal = 22835;

  // ==============================
  // æŒ‰æ—¶é—´é¡ºåºåº”ç”¨äº¤æ˜“ï¼Œè®¡ç®—æ¯æœˆæœ«æ€»èµ„äº§
  // ==============================
  const monthlyTotals = {};
  monthlyTotals["2025-12"] = initialTotal;

  // å…ˆå¤åˆ¶åˆå§‹ä½™é¢
  let current = JSON.parse(JSON.stringify(config.initialBalances));

  // æŒ‰æ—¥æœŸæ’åºäº¤æ˜“
  const sortedTxs = [...config.transactions].sort((a, b) => a.date.localeCompare(b.date));

  sortedTxs.forEach(tx => {
    // åº”ç”¨äº¤æ˜“
    tx.movements.forEach(m => {
      if (!current[m.platform]) {
        current[m.platform] = { HKD: 0, USD: 0, CNY: 0, US_Equity: 0 };
      }
      const key = m.currency === "US_Equity" ? "US_Equity" : m.currency;
      current[m.platform][key] += m.amount;
    });

    // è®¡ç®—å½“å‰æ€»èµ„äº§ï¼ˆâœ… ä¿®æ­£ US_Equity ä¸º USDï¼‰
    let total = 0;
    Object.values(current).forEach(bal => {
      total += toCNY(bal.HKD, "HKD") + 
               toCNY(bal.USD, "USD") + 
               bal.CNY + 
               toCNY(bal.US_Equity, "USD");
    });

    const month = getMonthKey(tx.date);
    monthlyTotals[month] = total;
  });

  // ==============================
  // æ¸²æŸ“æœˆåº¦æ€»è§ˆè¡¨ï¼ˆä» 2025-12 å¼€å§‹ï¼‰
  // ==============================
  const months = Object.keys(monthlyTotals).sort();
  const monthlyBody = document.getElementById("monthly-body");

  months.forEach((month, idx) => {
    const total = monthlyTotals[month];
    const prev = idx > 0 ? monthlyTotals[months[idx - 1]] : null;
    const change = prev !== null ? total - prev : 0;
    const changeStr = prev !== null ? (change >= 0 ? `+${formatNumber(change)}` : formatNumber(change)) : "â€”";
    const changeClass = change > 0 ? "positive" : change < 0 ? "negative" : "";

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${month}</td>
      <td>${formatNumber(total)}</td>
      <td class="${changeClass}">${changeStr}</td>
    `;
    monthlyBody.appendChild(row);
  });

  // ==============================
  // æ¸²æŸ“äº¤æ˜“æµæ°´ï¼ˆå€’åºï¼‰
  // ==============================
  const txBody = document.getElementById("transactions-body");
  config.transactions.slice().reverse().forEach(tx => {
    let detailHtml = "";
    tx.movements.forEach(m => {
      const sign = m.amount >= 0 ? "+" : "";
      const cls = m.amount >= 0 ? "inflow" : "outflow";
      detailHtml += `<div><span class="${cls}">${sign}${m.amount} ${m.currency}</span> â†’ ${m.platform}</div>`;
    });
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${tx.date}</td>
      <td>${tx.description}</td>
      <td>${detailHtml}</td>
    `;
    txBody.appendChild(row);
  });

  // ==============================
  // æ¸²æŸ“å½“å‰å¹³å°ä½™é¢
  // ==============================
  const balBody = document.getElementById("balances-body");
  let currentTotalCNY = 0;

  Object.entries(current).forEach(([platform, bal]) => {
    const hkdCNY = toCNY(bal.HKD, "HKD");
    const usdCNY = toCNY(bal.USD, "USD");
    const cny = bal.CNY;
    const equityCNY = toCNY(bal.US_Equity, "USD"); // âœ… å…³é”®ä¿®æ­£ï¼
    const total = hkdCNY + usdCNY + cny + equityCNY;
    currentTotalCNY += total;

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${platform}</td>
      <td>${bal.HKD}</td>
      <td>${bal.USD}</td>
      <td>${bal.CNY}</td>
      <td>${bal.US_Equity} USD</td> <!-- å¯é€‰ï¼šæ˜¾ç¤ºå•ä½ -->
      <td>${formatNumber(total)}</td>
    `;
    balBody.appendChild(row);
  });

  // å°è®¡è¡Œ
  const totalRow = document.createElement("tr");
  totalRow.className = "highlight";
  totalRow.innerHTML = `
    <td><strong>æ€»è®¡</strong></td>
    <td colspan="4"></td>
    <td><strong>${formatNumber(currentTotalCNY)}</strong></td>
  `;
  balBody.appendChild(totalRow);

</script>
</body>
</html>